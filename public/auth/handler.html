<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Authentication Handler</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script>
        // Fetch Firebase config from server
        fetch('/api/firebase-config')
            .then(response => response.json())
            .then(firebaseConfig => {
                // Initialize Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                // This page handles the authentication redirect
                firebase.auth().getRedirectResult()
                    .then((result) => {
                        // Redirect back to the login page which will handle the rest
                        window.location.href = '/auth/login';
                    })
                    .catch((error) => {
                        console.error('Auth redirect error:', error);
                        window.location.href = '/auth/login?error=' + encodeURIComponent(error.message);
                    });
            })
            .catch(error => {
                console.error('Failed to load Firebase config:', error);
                window.location.href = '/auth/login?error=configuration_error';
            });
    </script>
</head>
<body>
    <div style="text-align: center; padding: 20px;">
        <p>Completing authentication...</p>
    </div>
</body>
</html>